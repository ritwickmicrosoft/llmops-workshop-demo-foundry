<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LLMOps Workshop Playbook ‚Äî Azure AI Foundry</title>
  <style>
    :root {
      --bg: #0b0f19; --card: #111827; --text: #e5e7eb; --muted: #9ca3af;
      --link: #93c5fd; --border: rgba(255,255,255,0.10); --ok: #34d399;
      --warn: #fbbf24; --bad: #fb7185; --code: #0a1226;
      --shadow: 0 10px 30px rgba(0,0,0,0.35); --radius: 16px; --accent: #8b5cf6;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg: #f6f7fb; --card: #fff; --text: #0f172a; --muted: #475569;
        --link: #7c3aed; --border: rgba(2,6,23,0.10); --code: #f1f5f9;
        --shadow: 0 10px 30px rgba(2,6,23,0.10); }
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: var(--sans); color: var(--text); line-height: 1.6;
      background: radial-gradient(1200px 800px at 10% 0%, rgba(139,92,246,0.15), transparent 55%),
        radial-gradient(1200px 800px at 90% 10%, rgba(52,211,153,0.12), transparent 55%), var(--bg); }
    a { color: var(--link); text-decoration: none; } a:hover { text-decoration: underline; }
    .wrap { max-width: 1000px; margin: 0 auto; padding: 24px 16px 60px; }
    header { text-align: center; margin-bottom: 24px; }
    .logo { font-size: 44px; margin-bottom: 4px; }
    .title { font-size: 26px; font-weight: 800; background: linear-gradient(135deg, var(--accent), var(--ok));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: var(--muted); font-size: 14px; margin-top: 4px; }
    .meta-row { display: flex; justify-content: center; gap: 18px; margin-top: 10px; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--muted); }
    .pillrow { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
    .pill { border: 1px solid var(--border); background: color-mix(in srgb, var(--card) 75%, transparent);
      padding: 3px 8px; border-radius: 999px; font-size: 10px; color: var(--muted); }
    .card { background: color-mix(in srgb, var(--card) 95%, transparent); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow); padding: 16px 18px; margin-bottom: 14px; }
    .module { border-left: 4px solid var(--accent); }
    .module-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .module-number { background: var(--accent); color: white; font-weight: 700; font-size: 12px;
      padding: 2px 9px; border-radius: 999px; }
    .module-title { font-size: 16px; font-weight: 700; flex: 1; }
    .module-time { font-size: 11px; color: var(--muted); background: color-mix(in srgb, var(--card) 60%, transparent);
      padding: 2px 7px; border-radius: 999px; border: 1px solid var(--border); }
    .step { display: flex; gap: 8px; padding: 10px 0; border-bottom: 1px solid var(--border); }
    .step:last-child { border-bottom: none; }
    .step-num { background: var(--accent); color: white; font-weight: 700; font-size: 11px;
      min-width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .step-content { flex: 1; }
    .step-title { font-weight: 600; margin-bottom: 4px; font-size: 14px; }
    .step-desc { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    pre { margin: 6px 0; padding: 12px 14px; border-radius: 8px; background: var(--code);
      border: 1px solid var(--border); overflow-x: auto; font-family: var(--mono); font-size: 12px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; }
    code { font-family: var(--mono); font-size: 11px; background: var(--code); padding: 2px 5px; border-radius: 4px; }
    .note { border-radius: 8px; padding: 10px 14px; margin: 10px 0; font-size: 12px; }
    .note-info { background: color-mix(in srgb, var(--link) 12%, transparent); border: 1px solid color-mix(in srgb, var(--link) 30%, transparent); }
    .note-info::before { content: "üí° "; font-weight: 700; }
    .note-success { background: color-mix(in srgb, var(--ok) 12%, transparent); border: 1px solid color-mix(in srgb, var(--ok) 30%, transparent); }
    .note-success::before { content: "‚úÖ "; font-weight: 700; }
    .note-warn { background: color-mix(in srgb, var(--warn) 15%, transparent); border: 1px solid color-mix(in srgb, var(--warn) 40%, transparent); }
    .note-warn::before { content: "‚ö†Ô∏è "; font-weight: 700; }
    .note-rbac { background: color-mix(in srgb, #06b6d4 12%, transparent); border: 1px solid color-mix(in srgb, #06b6d4 30%, transparent); }
    .note-rbac::before { content: "üîê "; font-weight: 700; }
    .toc { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; margin-bottom: 16px; }
    .toc-item { display: flex; align-items: center; gap: 6px; padding: 10px 14px;
      background: color-mix(in srgb, var(--card) 80%, transparent); border: 1px solid var(--border);
      border-radius: 8px; text-decoration: none; color: var(--text); font-size: 12px; transition: all 0.2s; }
    .toc-item:hover { border-color: var(--accent); transform: translateY(-1px); text-decoration: none; }
    .toc-num { background: var(--accent); color: white; font-weight: 700; font-size: 10px; padding: 2px 7px; border-radius: 999px; }
    footer { text-align: center; margin-top: 28px; padding-top: 14px; border-top: 1px solid var(--border); color: var(--muted); font-size: 11px; }
    h2 { font-size: 18px; margin: 0 0 12px 0; color: var(--text); }
    h3 { font-size: 15px; margin: 16px 0 8px 0; color: var(--text); }
    table { width: 100%; border-collapse: collapse; font-size: 12px; margin: 10px 0; }
    th, td { padding: 8px 10px; text-align: left; border: 1px solid var(--border); }
    th { background: var(--code); font-weight: 600; }
    ul, ol { margin: 8px 0; padding-left: 20px; }
    li { margin: 4px 0; font-size: 13px; }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">ü§ñ</div>
    <div class="title">LLMOps Workshop Playbook</div>
    <div class="subtitle">RAG Chatbot + LLMOps with Azure AI Foundry ‚Äî Step-by-Step Hands-On Lab</div>
    <div class="meta-row">
      <div class="meta-item">‚è±Ô∏è ~3 hours</div>
      <div class="meta-item">üë• Individual or team</div>
      <div class="meta-item">üíª VS Code + Azure CLI</div>
    </div>
    <div class="pillrow">
      <span class="pill">Azure AI Foundry</span>
      <span class="pill">Azure OpenAI (gpt-4o)</span>
      <span class="pill">Azure AI Search</span>
      <span class="pill">RAG Pattern</span>
      <span class="pill">Vector Embeddings</span>
      <span class="pill">RBAC (No Keys)</span>
      <span class="pill">Model Swap</span>
      <span class="pill">CI/CD Gates</span>
      <span class="pill">MLflow 2.18+</span>
    </div>
  </header>

  <!-- Prerequisites Card -->
  <section class="card">
    <h2>üìã Prerequisites</h2>
    <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Complete these before starting the workshop:</p>
    
    <table>
      <tr><th style="width:30%">Requirement</th><th>Details</th></tr>
      <tr><td>Azure Subscription</td><td>With permissions to create resources (Contributor or Owner role)</td></tr>
      <tr><td>Azure CLI</td><td>Version 2.50+ ‚Äî <code>az --version</code> to check</td></tr>
      <tr><td>Python</td><td>Version 3.10+ with pip ‚Äî <code>python --version</code></td></tr>
      <tr><td>VS Code</td><td>With Python extension installed</td></tr>
      <tr><td>Git</td><td>To clone the workshop repo</td></tr>
    </table>

    <div class="note note-rbac">
      <strong>RBAC Authentication:</strong> This workshop uses role-based access control (RBAC) with your Azure identity ‚Äî no API keys required! Your Azure CLI login credentials are used automatically.
    </div>
  </section>

  <!-- Architecture Overview -->
  <section class="card">
    <h2>üèóÔ∏è What You'll Build</h2>
    <p style="font-size:13px;margin-bottom:12px;">A complete RAG (Retrieval-Augmented Generation) chatbot for "Wall-E Electronics":</p>
    
    <!-- Static SVG diagram (works without JavaScript) -->
    <div style="background: var(--code); border-radius: 8px; padding: 16px; margin: 12px 0; overflow-x: auto;">
      <svg viewBox="0 0 800 200" style="width:100%;max-width:800px;height:auto;display:block;margin:0 auto;">
        <!-- User Box -->
        <rect x="10" y="60" width="100" height="80" rx="8" fill="#1e3a5f" stroke="#4a9eff" stroke-width="2"/>
        <text x="60" y="90" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">üñ•Ô∏è User</text>
        <text x="60" y="115" text-anchor="middle" fill="#ccc" font-size="11">Web Chat</text>
        
        <!-- Flask Box -->
        <rect x="180" y="60" width="100" height="80" rx="8" fill="#2d4a3e" stroke="#4ade80" stroke-width="2"/>
        <text x="230" y="90" text-anchor="middle" fill="#fff" font-size="12" font-weight="bold">‚öôÔ∏è Flask</text>
        <text x="230" y="115" text-anchor="middle" fill="#ccc" font-size="11">app.py</text>
        
        <!-- Azure Box (container) -->
        <rect x="350" y="20" width="440" height="160" rx="10" fill="none" stroke="#60a5fa" stroke-width="2" stroke-dasharray="5,5"/>
        <text x="570" y="45" text-anchor="middle" fill="#60a5fa" font-size="12" font-weight="bold">‚òÅÔ∏è Azure</text>
        
        <!-- Embeddings -->
        <rect x="370" y="70" width="100" height="60" rx="6" fill="#4a3a5f" stroke="#a78bfa" stroke-width="2"/>
        <text x="420" y="100" text-anchor="middle" fill="#fff" font-size="11">Embeddings</text>
        <text x="420" y="116" text-anchor="middle" fill="#aaa" font-size="9">text-embed-3</text>
        
        <!-- Vector Index -->
        <rect x="500" y="70" width="100" height="60" rx="6" fill="#3a4a5f" stroke="#60a5fa" stroke-width="2"/>
        <text x="550" y="100" text-anchor="middle" fill="#fff" font-size="11">Vector Index</text>
        <text x="550" y="116" text-anchor="middle" fill="#aaa" font-size="9">AI Search</text>
        
        <!-- GPT-4o -->
        <rect x="630" y="70" width="100" height="60" rx="6" fill="#5f3a3a" stroke="#f87171" stroke-width="2"/>
        <text x="680" y="100" text-anchor="middle" fill="#fff" font-size="11">gpt-4o</text>
        <text x="680" y="116" text-anchor="middle" fill="#aaa" font-size="9">LLM</text>
        
        <!-- Arrows with labels -->
        <defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#888"/></marker></defs>
        
        <!-- 1. Question: User -> Flask -->
        <line x1="110" y1="100" x2="175" y2="100" stroke="#888" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="142" y="92" text-anchor="middle" fill="#aaa" font-size="9">1. Question</text>
        
        <!-- 2. Embed: Flask -> Embeddings -->
        <line x1="280" y1="100" x2="365" y2="100" stroke="#888" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="322" y="92" text-anchor="middle" fill="#aaa" font-size="9">2. Embed</text>
        
        <!-- 3. Search: Embeddings -> Index -->
        <line x1="470" y1="100" x2="495" y2="100" stroke="#888" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="482" y="92" text-anchor="middle" fill="#aaa" font-size="8">3</text>
        
        <!-- 4. Context: Index -> Flask (curved back) -->
        <path d="M 550 130 Q 550 160 230 160 Q 230 145 230 140" fill="none" stroke="#888" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="390" y="172" text-anchor="middle" fill="#aaa" font-size="9">4. Context</text>
        
        <!-- 5. Generate: Flask -> GPT -->
        <path d="M 280 80 Q 320 50 680 70" fill="none" stroke="#888" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="480" y="52" text-anchor="middle" fill="#aaa" font-size="9">5. Generate</text>
        
        <!-- 6. Answer: GPT -> User (curved) -->
        <path d="M 680 130 Q 680 185 60 185 Q 60 145 60 140" fill="none" stroke="#4ade80" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="370" y="195" text-anchor="middle" fill="#4ade80" font-size="9">6. Answer</text>
      </svg>
    </div>

    <table>
      <tr><th>Component</th><th>Azure Service</th><th>Purpose</th></tr>
      <tr><td>AI Platform</td><td>Azure AI Foundry</td><td>Unified AI development hub</td></tr>
      <tr><td>LLM</td><td>Azure OpenAI (gpt-4o)</td><td>Generate responses</td></tr>
      <tr><td>Embeddings</td><td>Azure OpenAI (text-embedding-3-large)</td><td>Vectorize text</td></tr>
      <tr><td>Vector Store</td><td>Azure AI Search</td><td>Store &amp; search documents</td></tr>
      <tr><td>Frontend</td><td>Flask + HTML</td><td>Chat interface</td></tr>
      <tr><td>Auth</td><td>DefaultAzureCredential</td><td>RBAC (no keys)</td></tr>
    </table>

    <h3>üìÑ Sample Documents (9 files in data/ folder)</h3>
    <ul>
      <li><strong>Products (.txt):</strong> Laptop Pro 15, SmartWatch X200, NC500 Headphones, Tablet S10</li>
      <li><strong>Policies (.md):</strong> Return Policy, Warranty Policy, Shipping Policy, Troubleshooting Guide</li>
      <li><strong>Support (.pdf):</strong> FAQ Document</li>
    </ul>
  </section>

  <!-- Table of Contents -->
  <div class="toc">
    <a href="#m1" class="toc-item"><span class="toc-num">1</span> Environment Setup</a>
    <a href="#m2" class="toc-item"><span class="toc-num">2</span> Deploy Infrastructure</a>
    <a href="#m3" class="toc-item"><span class="toc-num">3</span> Create Vector Index</a>
    <a href="#m4" class="toc-item"><span class="toc-num">4</span> Run RAG Chatbot</a>
    <a href="#m5" class="toc-item"><span class="toc-num">5</span> Test &amp; Explore</a>
    <a href="#m6" class="toc-item"><span class="toc-num">6</span> Model Swap</a>
    <a href="#m7" class="toc-item"><span class="toc-num">7</span> CI/CD Gates</a>
    <a href="#m8" class="toc-item"><span class="toc-num">8</span> MLflow GenAI Ops</a>
    <a href="#troubleshooting" class="toc-item"><span class="toc-num">?</span> Troubleshooting</a>
  </div>

  <!-- Module 1: Environment Setup -->
  <section id="m1" class="card module">
    <div class="module-header">
      <span class="module-number">1</span>
      <span class="module-title">Environment Setup</span>
      <span class="module-time">10 min</span>
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Clone the workshop repository</div>
        <div class="step-desc">Open VS Code terminal (Ctrl+`) and run:</div>
        <pre>git clone https://github.com/ritwickmicrosoft/llmops-workshop-demo.git
cd llmops-workshop-demo</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Create Python virtual environment</div>
        <pre># Create virtual environment
python -m venv .venv

# Activate it (Windows PowerShell)
.\.venv\Scripts\Activate.ps1

# Or on Mac/Linux:
# source .venv/bin/activate</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Install Python dependencies</div>
        <pre>pip install -r requirements.txt</pre>
        <div class="step-desc">Installs: azure-identity, azure-search-documents, openai, flask, flask-cors</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Login to Azure CLI</div>
        <pre># Login to Azure
az login

# Set your subscription (if you have multiple)
az account set --subscription "YOUR-SUBSCRIPTION-NAME-OR-ID"

# Verify you're logged in
az account show --query "{name:name, id:id}" -o table</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Set environment variables</div>
        <div class="step-desc">These variables are used throughout the workshop:</div>
        <pre># PowerShell
$env:AZURE_SUBSCRIPTION_ID = (az account show --query id -o tsv)
$env:AZURE_RESOURCE_GROUP = "rg-llmops-canadaeast"
$env:AZURE_LOCATION = "canadaeast"</pre>
      </div>
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> You should see your subscription name when running <code>az account show</code>
    </div>
  </section>

  <!-- Module 2: Deploy Infrastructure -->
  <section id="m2" class="card module">
    <div class="module-header">
      <span class="module-number">2</span>
      <span class="module-title">Deploy Azure Infrastructure</span>
      <span class="module-time">25 min</span>
    </div>

    <div class="note note-info">
      We'll create all resources via Azure CLI commands. This gives you visibility into what's being deployed.
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Create Resource Group</div>
        <pre>az group create --name $env:AZURE_RESOURCE_GROUP --location $env:AZURE_LOCATION</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Create Azure AI Foundry Resource</div>
        <div class="step-desc">This creates the AI Foundry resource with public network access enabled:</div>
        <pre>az cognitiveservices account create `
  --name "foundry-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --location $env:AZURE_LOCATION `
  --kind AIServices `
  --sku S0 `
  --custom-domain "foundry-llmops-canadaeast"</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Create Foundry Project</div>
        <div class="step-desc">Create a project within the AI Services resource:</div>
        <pre>az cognitiveservices account project create `
  --project-name "proj-llmops-demo" `
  --name "foundry-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --location $env:AZURE_LOCATION</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Deploy GPT-4o Model</div>
        <div class="step-desc">Deploy models directly to the AI Services resource (no separate Azure OpenAI needed):</div>
        <pre>az cognitiveservices account deployment create `
  --name "foundry-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --deployment-name "gpt-4o" `
  --model-name "gpt-4o" `
  --model-version "2024-11-20" `
  --model-format OpenAI `
  --sku-capacity 10 `
  --sku-name Standard</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Deploy Embedding Model</div>
        <pre>az cognitiveservices account deployment create `
  --name "foundry-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --deployment-name "text-embedding-3-large" `
  --model-name "text-embedding-3-large" `
  --model-version "1" `
  --model-format OpenAI `
  --sku-capacity 10 `
  --sku-name Standard</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-content">
        <div class="step-title">Create Azure AI Search</div>
        <pre>az search service create `
  --name "search-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --location $env:AZURE_LOCATION `
  --sku Basic `
  --partition-count 1 `
  --replica-count 1</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">7</div>
      <div class="step-content">
        <div class="step-title">Assign RBAC Roles to Your User</div>
        <div class="step-desc">Grant yourself permissions to use these services:</div>
        <pre># Get your user ID
$myId = (az ad signed-in-user show --query id -o tsv)

# OpenAI permissions
az role assignment create `
  --assignee $myId `
  --role "Cognitive Services OpenAI User" `
  --scope $(az cognitiveservices account show --name foundry-llmops-canadaeast --resource-group $env:AZURE_RESOURCE_GROUP --query id -o tsv)

# Search permissions
az role assignment create `
  --assignee $myId `
  --role "Search Index Data Contributor" `
  --scope $(az search service show --name search-llmops-canadaeast --resource-group $env:AZURE_RESOURCE_GROUP --query id -o tsv)

az role assignment create `
  --assignee $myId `
  --role "Search Service Contributor" `
  --scope $(az search service show --name search-llmops-canadaeast --resource-group $env:AZURE_RESOURCE_GROUP --query id -o tsv)</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">8</div>
      <div class="step-content">
        <div class="step-title">Update .env file with your endpoints</div>
        <div class="step-desc">Copy the example and update with your resource names:</div>
        <pre># Copy the example file
Copy-Item .env.example .env

# Edit .env with your endpoints:
FOUNDRY_PROJECT_ENDPOINT=https://foundry-llmops-canadaeast.services.ai.azure.com/api/projects/proj-llmops-demo
CHAT_MODEL=gpt-4o
EMBEDDING_MODEL=text-embedding-3-large
AZURE_SEARCH_ENDPOINT=https://search-llmops-canadaeast.search.windows.net
AZURE_SEARCH_INDEX_NAME=walle-products</pre>
      </div>
    </div>

    <div class="note note-warn">
      <strong>Wait 2-3 minutes</strong> for RBAC role assignments to propagate before proceeding.
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> Run <code>az cognitiveservices account deployment list --name foundry-llmops-canadaeast --resource-group $env:AZURE_RESOURCE_GROUP -o table</code> ‚Äî you should see gpt-4o and text-embedding-3-large.
    </div>
  </section>

  <!-- Module 3: Create Vector Index -->
  <section id="m3" class="card module">
    <div class="module-header">
      <span class="module-number">3</span>
      <span class="module-title">Create Vector Index with Sample Documents</span>
      <span class="module-time">15 min</span>
    </div>

    <div class="note note-info">
      This step reads 9 documents from the <code>data/</code> folder (.txt, .md, .pdf files) and creates a vector search index. Each document is vectorized using text-embedding-3-large.
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Navigate to the RAG folder</div>
        <pre>cd 01-rag-chatbot</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Run the index creation script</div>
        <pre>python create_search_index.py</pre>
        <div class="step-desc">This script:</div>
        <ol>
          <li>Authenticates using your Azure CLI credentials (DefaultAzureCredential)</li>
          <li>Reads all .txt, .md, and .pdf files from the <code>data/</code> folder</li>
          <li>Creates a search index called <code>walle-products</code></li>
          <li>Generates embeddings for each document using text-embedding-3-large</li>
          <li>Uploads documents with vectors to Azure AI Search</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Expected output</div>
        <pre>============================================================
  LLMOps Workshop - Create AI Search Index
============================================================

[1/4] Authenticating with Azure...
  ‚úì Using DefaultAzureCredential (RBAC)

[2/4] Initializing clients...
  ‚úì Foundry project endpoint: https://foundry-llmops-canadaeast.services.ai.azure.com/api/projects/proj-llmops-demo
  ‚úì Search endpoint: https://search-llmops-canadaeast.search.windows.net

[3/4] Creating search index...
  Created index: walle-products

[4/4] Indexing sample documents...
  Processing: Return Policy - Electronics
  Processing: SmartWatch X200 User Guide
  Processing: Warranty Policy
  Processing: Wall-E Laptop Pro 15 Specifications
  Processing: Common Troubleshooting Steps
  Processing: NC500 Noise-Cancelling Headphones
  Processing: Shipping and Delivery Policy
  Processing: Wall-E Tablet S10 Guide
  Indexed 8/8 documents

============================================================
  ‚úì Index creation complete!
============================================================</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Verify the index in Azure Portal (optional)</div>
        <div class="step-desc">Open Azure Portal ‚Üí AI Search ‚Üí search-llmops-canadaeast ‚Üí Indexes ‚Üí walle-products</div>
        <p style="font-size:12px;color:var(--muted);">You should see 8 documents with fields: id, title, category, content, last_updated, content_vector</p>
      </div>
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> The script should report "Indexed 8/8 documents"
    </div>
  </section>

  <!-- Module 4: Run RAG Chatbot -->
  <section id="m4" class="card module">
    <div class="module-header">
      <span class="module-number">4</span>
      <span class="module-title">Run the RAG Chatbot</span>
      <span class="module-time">10 min</span>
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Navigate to the frontend folder</div>
        <pre>cd ../04-frontend</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Start the Flask server</div>
        <pre>python app.py</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Expected startup output</div>
        <pre>============================================================
  ü§ñ Wall-E Electronics - RAG Chatbot
  Powered by Microsoft Foundry
============================================================

  üîê Authentication: RBAC (Managed Identity / Azure CLI)

  üèóÔ∏è  Microsoft Foundry:
    ‚Ä¢ Resource: foundry-llmops-canadaeast
    ‚Ä¢ Project: proj-llmops-demo
    ‚Ä¢ Endpoint: https://foundry-llmops-canadaeast.services.ai.azure.com/

  üì° Inference (via Foundry - no separate Azure OpenAI):
    ‚Ä¢ Chat Model: gpt-4o
    ‚Ä¢ Embedding Model: text-embedding-3-large

  üîç Azure AI Search:
    ‚Ä¢ Endpoint: https://search-llmops-canadaeast.search.windows.net
    ‚Ä¢ Index: walle-products

  üöÄ Starting server at http://localhost:5000
============================================================
 * Running on http://127.0.0.1:5000</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Open the chat interface</div>
        <div class="step-desc">Open your browser to:</div>
        <pre>http://localhost:5000</pre>
        <p style="font-size:12px;color:var(--muted);">You'll see a dark-themed chat interface with "Wall-E Electronics" branding.</p>
      </div>
    </div>

    <div class="note note-info">
      The "ImdsCredential.get_token failed" message is normal when running locally ‚Äî it means Managed Identity isn't available, so it falls back to Azure CLI credentials.
    </div>
  </section>

  <!-- Module 5: Test & Explore -->
  <section id="m5" class="card module">
    <div class="module-header">
      <span class="module-number">5</span>
      <span class="module-title">Test &amp; Explore the RAG Chatbot</span>
      <span class="module-time">20 min</span>
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Test product questions</div>
        <div class="step-desc">Try these queries in the chat:</div>
        <pre>What laptops do you have?
What are the specs of the Laptop Pro 15?
How much are the NC500 headphones?
Tell me about the SmartWatch X200</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Test policy questions</div>
        <pre>What is the return policy for headphones?
What's covered under warranty?
How long is the warranty on laptops?
What shipping options do you offer?</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Test troubleshooting questions</div>
        <pre>How do I reset my SmartWatch X200?
My laptop won't turn on, what should I do?
My headphones won't connect via Bluetooth</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Observe the RAG in action</div>
        <div class="step-desc">Notice how the chatbot:</div>
        <ul>
          <li>Answers based on actual document content (grounded)</li>
          <li>Provides specific details like prices, specs, and policies</li>
          <li>Says "I don't know" when asked about products not in the index</li>
          <li>Doesn't hallucinate information</li>
        </ul>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Try a question outside the knowledge base</div>
        <pre>Do you sell televisions?
What's the price of an iPhone?</pre>
        <div class="step-desc">The chatbot should acknowledge it doesn't have information about these products.</div>
      </div>
    </div>

    <h3>üîç Understanding the RAG Flow</h3>
    <p style="font-size:13px;margin-bottom:10px;">Each query goes through these steps:</p>
    <table>
      <tr><th>Step</th><th>What Happens</th><th>Azure Service</th></tr>
      <tr><td>1. Embed Query</td><td>User question ‚Üí 3072-dim vector</td><td>Azure OpenAI (text-embedding-3-large)</td></tr>
      <tr><td>2. Vector Search</td><td>Find top 3 similar documents</td><td>Azure AI Search (HNSW algorithm)</td></tr>
      <tr><td>3. Augment Prompt</td><td>Add retrieved docs to system prompt</td><td>Python (app.py)</td></tr>
      <tr><td>4. Generate Response</td><td>LLM creates grounded answer</td><td>Azure OpenAI (gpt-4o)</td></tr>
    </table>

    <div class="note note-success">
      <strong>Congratulations!</strong> You've built a working RAG chatbot using Azure AI Foundry services with RBAC authentication.
    </div>
  </section>

  <!-- Troubleshooting -->
  <section id="troubleshooting" class="card">
    <h2>üîß Troubleshooting</h2>

    <h3>‚ùå "AuthenticationError" or "401 Unauthorized"</h3>
    <ul>
      <li>Run <code>az login</code> to refresh your credentials</li>
      <li>Verify RBAC roles are assigned: <code>az role assignment list --assignee $(az ad signed-in-user show --query id -o tsv) --scope /subscriptions/$env:AZURE_SUBSCRIPTION_ID/resourceGroups/$env:AZURE_RESOURCE_GROUP -o table</code></li>
      <li>Wait 2-3 minutes after assigning roles for propagation</li>
    </ul>

    <h3>‚ùå "Resource not found" errors</h3>
    <ul>
      <li>Verify resource names match in .env file</li>
      <li>Check resources exist: <code>az resource list --resource-group $env:AZURE_RESOURCE_GROUP -o table</code></li>
      <li>Ensure you're using the correct subscription</li>
    </ul>

    <h3>‚ùå "Model deployment not found"</h3>
    <ul>
      <li>List deployments: <code>az cognitiveservices account deployment list --name foundry-llmops-canadaeast --resource-group $env:AZURE_RESOURCE_GROUP -o table</code></li>
      <li>Deployment names must match exactly: <code>gpt-4o</code> and <code>text-embedding-3-large</code></li>
    </ul>

    <h3>‚ùå "Search index not found"</h3>
    <ul>
      <li>Re-run: <code>python 01-rag-chatbot/create_search_index.py</code></li>
      <li>Verify index name in .env: <code>AZURE_SEARCH_INDEX_NAME=walle-products</code></li>
    </ul>

    <h3>‚ùå Flask app won't start</h3>
    <ul>
      <li>Ensure virtual environment is activated: <code>.\.venv\Scripts\Activate.ps1</code></li>
      <li>Install dependencies: <code>pip install -r 04-frontend/requirements.txt</code></li>
      <li>Check port 5000 isn't in use</li>
    </ul>

    <h3>‚ùå "ImdsCredential.get_token failed" warning</h3>
    <p style="font-size:12px;color:var(--muted);">This is <strong>normal</strong> when running locally. The SDK tries Managed Identity first (for Azure VMs), then falls back to Azure CLI credentials. Your app will still work.</p>
  </section>

  <!-- Evaluation Module -->
  <section class="card">
    <h2>üìä Step 6: Run Evaluation</h2>
    <p style="font-size:13px;margin-bottom:15px;">Test RAG quality using Azure AI Evaluation SDK with Groundedness and Fluency metrics.</p>

    <div class="step">
      <span class="num">1</span>
      <div>
        <strong>Run evaluation script</strong>
        <pre>python 02-evaluation/run_evaluation.py</pre>
        <p style="font-size:11px;color:var(--muted);margin-top:5px;">Uses Foundry project endpoint from default config. Generates JSON results + HTML report in <code>02-evaluation/eval_results/</code></p>
      </div>
    </div>

    <div class="step">
      <span class="num">2</span>
      <div>
        <strong>Review metrics</strong>
        <table style="font-size:11px;margin:10px 0;border-collapse:collapse;width:100%;">
          <tr style="background:var(--surface);">
            <th style="padding:8px;border:1px solid var(--border);">Metric</th>
            <th style="padding:8px;border:1px solid var(--border);">Description</th>
            <th style="padding:8px;border:1px solid var(--border);">Target</th>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid var(--border);"><strong>Groundedness</strong></td>
            <td style="padding:8px;border:1px solid var(--border);">Is response supported by retrieved context?</td>
            <td style="padding:8px;border:1px solid var(--border);">‚â•4.0/5.0</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid var(--border);"><strong>Fluency</strong></td>
            <td style="padding:8px;border:1px solid var(--border);">Is response grammatically correct?</td>
            <td style="padding:8px;border:1px solid var(--border);">‚â•4.0/5.0</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="note note-info">
      <strong>Scoring Standards:</strong><br/>
      ‚Ä¢ <span style="color:var(--ok);">4.0-5.0</span> = Excellent (production-ready)<br/>
      ‚Ä¢ <span style="color:var(--warn);">3.0-4.0</span> = Good (minor improvements)<br/>
      ‚Ä¢ <span style="color:#ef4444;">2.0-3.0</span> = Needs work (improve prompts/retrieval)<br/>
      ‚Ä¢ <span style="color:#dc2626;">1.0-2.0</span> = Poor (major rework)
    </div>
  </section>

  <!-- Content Safety Module -->
  <section class="card">
    <h2>üõ°Ô∏è Step 7: Content Safety Testing</h2>
    <p style="font-size:13px;margin-bottom:15px;">Test protection against harmful content and prompt injection attacks.</p>

    <div class="step">
      <span class="num">1</span>
      <div>
        <strong>Run content safety tests</strong>
        <pre>python 03-content-safety/test_content_safety.py</pre>
        <p style="font-size:11px;color:var(--muted);margin-top:5px;">Generates JSON results + HTML report in <code>03-content-safety/test_results/</code></p>
      </div>
    </div>

    <div class="step">
      <span class="num">2</span>
      <div>
        <strong>Understand test categories</strong>
        <table style="font-size:11px;margin:10px 0;border-collapse:collapse;width:100%;">
          <tr style="background:var(--surface);">
            <th style="padding:8px;border:1px solid var(--border);">Category</th>
            <th style="padding:8px;border:1px solid var(--border);">Tests</th>
            <th style="padding:8px;border:1px solid var(--border);">Expected Result</th>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid var(--border);"><strong>Baseline</strong></td>
            <td style="padding:8px;border:1px solid var(--border);">Normal product queries</td>
            <td style="padding:8px;border:1px solid var(--border);color:var(--ok);">‚úì Allowed</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid var(--border);"><strong>Jailbreak</strong></td>
            <td style="padding:8px;border:1px solid var(--border);">DAN, role-play, developer mode</td>
            <td style="padding:8px;border:1px solid var(--border);color:var(--warn);">Model refuses</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid var(--border);"><strong>Boundary</strong></td>
            <td style="padding:8px;border:1px solid var(--border);">Off-topic, competitor, PII</td>
            <td style="padding:8px;border:1px solid var(--border);color:var(--warn);">Model refuses</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="note note-info">
      <strong>Azure OpenAI Default Filters:</strong><br/>
      ‚Ä¢ <strong>Blocked automatically:</strong> Hate, Sexual, Violence, Self-harm (medium severity)<br/>
      ‚Ä¢ <strong>Not blocked by default:</strong> Jailbreak/Prompt injection (needs custom config)<br/>
      ‚Ä¢ <strong>Primary defense:</strong> System prompts handle jailbreak attempts
    </div>

    <div class="note note-warn">
      <strong>Production Tip:</strong> Enable <strong>Prompt Shields</strong> in Azure OpenAI for additional jailbreak protection.
    </div>
  </section>

  <!-- Module 6: Model Swap + Re-Evaluation -->
  <section id="m6" class="card module">
    <div class="module-header">
      <span class="module-number">6</span>
      <span class="module-title">Model Swap + Re-Evaluation</span>
      <span class="module-time">25 min</span>
    </div>

    <div class="note note-info">
      Safely replace a production model (e.g., gpt-4o ‚Üí gpt-4o-mini) by automatically running the same evaluation suite against both models and comparing results side-by-side. Uses the Foundry Model Catalog for model deployment.
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Why would you swap a model?</div>
        <div class="step-desc">In production LLM applications, model changes happen frequently:</div>
        <table>
          <tr><th>Trigger</th><th>Example</th></tr>
          <tr><td><strong>Cost optimization</strong></td><td>gpt-4o ‚Üí gpt-4o-mini (~15x cheaper per token) while maintaining acceptable quality</td></tr>
          <tr><td><strong>Latency requirements</strong></td><td>Smaller models respond faster for real-time customer support scenarios</td></tr>
          <tr><td><strong>New model version</strong></td><td>Azure ships gpt-4o <code>2024-11-20</code> with improved reasoning ‚Äî validate before adopting</td></tr>
          <tr><td><strong>Model deprecation</strong></td><td>Azure retires older model versions on published dates ‚Äî forced migration</td></tr>
          <tr><td><strong>Capacity/availability</strong></td><td>Quota limits or regional availability require switching model families</td></tr>
        </table>
        <div class="note note-warn" style="margin-top:8px;">
          <strong>The risk:</strong> Swapping blindly can degrade answer quality ‚Äî customers notice before your team does. This workflow prevents that by auto-evaluating both models on the same test set.
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Understand the safe-swap workflow</div>
        <div class="step-desc">The model swap script follows a safe promotion pattern:</div>
        <table>
          <tr><th>Step</th><th>What Happens</th></tr>
          <tr><td>1. Baseline</td><td>Run 4-metric evaluation against the <strong>current</strong> model (gpt-4o)</td></tr>
          <tr><td>2. Candidate</td><td>Run the <strong>same</strong> evaluation against the <strong>candidate</strong> model (gpt-4o-mini)</td></tr>
          <tr><td>3. Compare</td><td>Side-by-side comparison of all metrics</td></tr>
          <tr><td>4. Gate</td><td>Candidate must meet thresholds <strong>AND</strong> not regress more than 0.5 points</td></tr>
        </table>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Deploy a candidate model (gpt-4o-mini)</div>
        <div class="step-desc">If not already deployed, add the candidate model:</div>
        <pre>az cognitiveservices account deployment create `
  --name "foundry-llmops-canadaeast" `
  --resource-group $env:AZURE_RESOURCE_GROUP `
  --deployment-name "gpt-4o-mini" `
  --model-name "gpt-4o-mini" `
  --model-version "2024-07-18" `
  --model-format OpenAI `
  --sku-capacity 10 `
  --sku-name Standard</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Run the model swap comparison</div>
        <pre>cd 05-model-swap
python model_swap_eval.py</pre>
        <div class="step-desc">Default: compares gpt-4o (current) vs gpt-4o-mini (candidate). Uses <code>02-evaluation/eval_dataset.jsonl</code> as the test set.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Expected output</div>
        <pre>============================================================
  Model Swap & Re-Evaluation Workflow
============================================================

  [1/4] Evaluating current model: gpt-4o
    Groundedness: 4.20  Relevance: 4.10
    Similarity: 3.80    Fluency: 4.50

  [2/4] Evaluating candidate model: gpt-4o-mini
    Groundedness: 3.90  Relevance: 3.80
    Similarity: 3.50    Fluency: 4.30

  [3/4] Side-by-Side Comparison
    Metric         Current   Candidate   Delta
    groundedness   4.20      3.90        -0.30
    relevance      4.10      3.80        -0.30
    similarity     3.80      3.50        -0.30
    fluency        4.50      4.30        -0.20

  [4/4] Promotion Gate
    ‚úì All metrics within regression tolerance (max 0.5)
    ‚úì SWAP RECOMMENDED
============================================================</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-content">
        <div class="step-title">CLI options for advanced use</div>
        <pre># Specify different models
python model_swap_eval.py --current gpt-4o --candidate gpt-4o-mini

# Skip re-evaluating current model (use cached results)
python model_swap_eval.py --candidate gpt-4o-mini --skip-current

# CI mode: exit code 1 if swap not recommended
python model_swap_eval.py --ci

# Stricter regression tolerance
python model_swap_eval.py --max-regression 0.3</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">7</div>
      <div class="step-content">
        <div class="step-title">Review the HTML comparison report</div>
        <div class="step-desc">Open the generated report:</div>
        <pre># Results saved to:
#   05-model-swap/comparison_results/comparison_*.json
#   05-model-swap/comparison_results/comparison_report_*.html</pre>
        <p style="font-size:12px;color:var(--muted);">The report shows a side-by-side table with color-coded deltas (green = improvement, red = regression).</p>
      </div>
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> You should see a comparison table with all 4 metrics for both models and a PASS/FAIL verdict.
    </div>

    <div class="note note-warn">
      <strong>Key Takeaway:</strong> The model swap workflow ensures you never deploy a weaker model to production ‚Äî the evaluation gate catches regressions automatically.
    </div>
  </section>

  <!-- Module 7: CI/CD with Promotion Gates -->
  <section id="m7" class="card module">
    <div class="module-header">
      <span class="module-number">7</span>
      <span class="module-title">CI/CD with Promotion Gates</span>
      <span class="module-time">25 min</span>
    </div>

    <div class="note note-info">
      An Azure DevOps YAML pipeline that automatically runs evaluation + content safety + model swap checks before allowing deployment. Failed gates block the merge.
    </div>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Pipeline architecture</div>
        <div class="step-desc">The pipeline has 4 stages that run sequentially ‚Äî each stage is a gate:</div>
        <table>
          <tr><th>Stage</th><th>Gate</th><th>Blocks Deploy If</th></tr>
          <tr><td>1. EvaluationGate</td><td>4-metric quality check</td><td>Any metric below threshold (default ‚â•4.0)</td></tr>
          <tr><td>2. ContentSafetyGate</td><td>Content safety tests</td><td>Safety pass rate below 90%</td></tr>
          <tr><td>3. ModelSwapGate</td><td>Side-by-side comparison</td><td>Candidate regresses more than 0.5 (conditional*)</td></tr>
          <tr><td>4. Deploy</td><td>Deploy to Azure</td><td>Only runs on <code>main</code> after all gates pass</td></tr>
        </table>
        <p style="font-size:11px;color:var(--muted);margin-top:5px;">*ModelSwapGate is conditional ‚Äî only runs when commit message contains <code>[model-swap]</code> or <code>RUN_MODEL_SWAP=true</code>.</p>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Review the pipeline YAML</div>
        <div class="step-desc">Open the pipeline definition:</div>
        <pre>code 06-cicd/azure-pipelines.yml</pre>
        <p style="font-size:12px;color:var(--muted);">Key sections: <code>trigger</code> (paths that activate it), <code>variables</code> (thresholds), and 4 <code>stages</code>.</p>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">Test the promotion gate locally</div>
        <div class="step-desc">The gate logic is a standalone script you can run locally before pushing:</div>
        <pre># Check evaluation results against thresholds
python 06-cicd/promotion_gate.py --check-eval `
  --results 02-evaluation/eval_results/eval_results_20260211_141933.json `
  --threshold 4.0

# Check content safety pass rate
python 06-cicd/promotion_gate.py --check-content-safety `
  --results-dir 03-content-safety/test_results `
  --min-pass-rate 90

# Check model comparison (no regression above 0.5)
python 06-cicd/promotion_gate.py --check-comparison `
  --results 05-model-swap/comparison_results/latest.json `
  --max-regression 0.5</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Expected gate output</div>
        <pre>============================================================
  Promotion Gate: Evaluation Quality
============================================================
  Checking: eval_results_20260211_141933.json
  Threshold: 4.0

  groundedness:  4.20  ‚úì PASS
  relevance:     4.10  ‚úì PASS
  similarity:    3.80  ‚úó FAIL (below 4.0)
  fluency:       4.50  ‚úì PASS

  Result: GATE FAILED (1 metric below threshold)
  Exit code: 1
============================================================</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Set up in Azure DevOps (walkthrough)</div>
        <div class="step-desc">To connect this pipeline to Azure DevOps:</div>
        <ol>
          <li><strong>Service Connection:</strong> Create <code>llmops-service-connection</code> (type: Azure Resource Manager) pointing to your subscription</li>
          <li><strong>RBAC for pipeline:</strong> Grant the service principal: <code>Cognitive Services OpenAI User</code> on <code>foundry-llmops-canadaeast</code> and <code>Search Index Data Reader</code> on <code>search-llmops-canadaeast</code></li>
          <li><strong>Import pipeline:</strong> Pipelines ‚Üí New Pipeline ‚Üí Existing YAML ‚Üí select <code>06-cicd/azure-pipelines.yml</code></li>
          <li><strong>Test it:</strong> Create a PR to see all gates run automatically</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-content">
        <div class="step-title">Understanding the gate pattern</div>
        <div class="step-desc">Why gates matter for LLMOps:</div>
        <table>
          <tr><th>Without Gates</th><th>With Gates</th></tr>
          <tr><td>Prompt change ‚Üí deploy ‚Üí discover regression in prod</td><td>Prompt change ‚Üí eval gate catches regression ‚Üí merge blocked</td></tr>
          <tr><td>Model swap ‚Üí hope it's okay ‚Üí users notice quality drop</td><td>Model swap ‚Üí side-by-side comparison ‚Üí auto-reject if worse</td></tr>
          <tr><td>Manual review of safety ‚Üí inconsistent</td><td>Content safety tests run every PR ‚Üí always enforced</td></tr>
        </table>
      </div>
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> Running <code>python 06-cicd/promotion_gate.py --check-eval --results &lt;your-results.json&gt;</code> should print a PASS/FAIL verdict.
    </div>

    <div class="note note-rbac">
      <strong>Pipeline RBAC:</strong> The Azure DevOps service principal needs <code>Cognitive Services OpenAI User</code> on the Foundry resource to run evaluations in CI.
    </div>
  </section>

  <!-- Module 8: MLflow for GenAI Ops -->
  <section id="m8" class="card module">
    <div class="module-header">
      <span class="module-number">8</span>
      <span class="module-title">MLflow for GenAI Ops</span>
      <span class="module-time">25 min</span>
    </div>

    <div class="note note-info">
      MLflow 2.18+ adds GenAI-specific features: LLM tracing, prompt versioning, and <code>mlflow.evaluate()</code>. This module shows how MLflow complements Foundry in the development loop.
    </div>

    <h3>How MLflow + Foundry Work Together</h3>
    <table>
      <tr><th>Capability</th><th>Foundry</th><th>MLflow</th></tr>
      <tr><td>Production inference</td><td style="color:var(--ok);">‚úì Primary</td><td>‚Äî</td></tr>
      <tr><td>Content safety</td><td style="color:var(--ok);">‚úì Primary</td><td>‚Äî</td></tr>
      <tr><td>Managed deployments</td><td style="color:var(--ok);">‚úì Primary</td><td>‚Äî</td></tr>
      <tr><td>Experiment tracking</td><td>‚Äî</td><td style="color:var(--ok);">‚úì Primary</td></tr>
      <tr><td>Prompt versioning</td><td>‚Äî</td><td style="color:var(--ok);">‚úì Primary</td></tr>
      <tr><td>LLM call tracing</td><td>‚Äî</td><td style="color:var(--ok);">‚úì Primary</td></tr>
      <tr><td>Offline evaluation</td><td>Azure AI Eval SDK</td><td>mlflow.evaluate()</td></tr>
    </table>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <div class="step-title">Install MLflow</div>
        <pre>pip install mlflow>=2.18.0 pandas>=2.0.0</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <div class="step-title">Demo A: MLflow Tracing + Prompt Versioning</div>
        <div class="step-desc">Captures full traces of every LLM call and versions prompt templates:</div>
        <pre>cd 07-mlflow
python mlflow_tracing_demo.py</pre>
        <div class="step-desc">This runs 3 demos:</div>
        <ol>
          <li><strong>Tracing:</strong> Uses <code>mlflow.openai.autolog()</code> to automatically capture every OpenAI call ‚Äî inputs, outputs, tokens, latency</li>
          <li><strong>Prompt Versioning:</strong> Logs 3 prompt template versions (v1_basic ‚Üí v2_rag ‚Üí v3_structured) as MLflow artifacts with quality metrics</li>
          <li><strong>App Config Versioning:</strong> Logs full RAG pipeline configs (model + prompt + search settings) as versioned experiments</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <div class="step-title">View traces in MLflow UI</div>
        <pre># Start MLflow UI (in a separate terminal)
mlflow ui --port 5001

# Open browser to:
# http://localhost:5001</pre>
        <div class="step-desc">Navigate to the <code>llmops-tracing-demo</code> experiment. Click any run to see full call traces with input/output tokens and latency.</div>
      </div>
    </div>

    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <div class="step-title">Compare prompt versions in MLflow</div>
        <div class="step-desc">In MLflow UI:</div>
        <ol>
          <li>Go to <code>llmops-prompt-versions</code> experiment</li>
          <li>Select all 3 runs (v1_basic, v2_rag, v3_structured)</li>
          <li>Click <strong>Compare</strong> to see prompt lengths, token usage, and response quality side-by-side</li>
          <li>Click <strong>Artifacts ‚Üí prompts</strong> to view the actual prompt template text</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-num">5</div>
      <div class="step-content">
        <div class="step-title">Demo B: MLflow Evaluate</div>
        <div class="step-desc">Run MLflow's built-in evaluation suite with custom evaluators:</div>
        <pre>python mlflow_eval_demo.py</pre>
        <div class="step-desc">This shows:</div>
        <ol>
          <li><strong>mlflow.evaluate():</strong> Built-in QA evaluation with LLM-as-judge metrics</li>
          <li><strong>Custom Evaluators:</strong> Response length checker, citation detector, hallucination keyword scanner</li>
          <li><strong>Comparison Table:</strong> Side-by-side view of Azure AI Eval SDK vs MLflow evaluate()</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-num">6</div>
      <div class="step-content">
        <div class="step-title">When to use which evaluation tool</div>
        <table>
          <tr><th>Scenario</th><th>Use</th><th>Why</th></tr>
          <tr><td>CI/CD pipeline gates</td><td>Azure AI Eval SDK</td><td>Production-grade, integrates with Foundry portal</td></tr>
          <tr><td>Local prompt iteration</td><td>MLflow evaluate()</td><td>Fast, offline, great for experimentation</td></tr>
          <tr><td>Custom quality checks</td><td>MLflow custom evaluators</td><td>Easy to write Python functions as evaluators</td></tr>
          <tr><td>Call-level debugging</td><td>MLflow tracing</td><td>Full trace of every LLM call with latency</td></tr>
          <tr><td>Prompt A/B testing</td><td>MLflow experiments</td><td>Compare runs, metrics, artifacts side-by-side</td></tr>
        </table>
      </div>
    </div>

    <div class="note note-success">
      <strong>Checkpoint:</strong> MLflow UI at <code>http://localhost:5001</code> should show 3 experiments: <code>llmops-tracing-demo</code>, <code>llmops-prompt-versions</code>, <code>llmops-app-versions</code>.
    </div>

    <div class="note note-warn">
      <strong>Production Note:</strong> For production tracking, connect MLflow to Azure ML workspace as the remote tracking server instead of local <code>mlruns/</code> directory.
    </div>
  </section>

  <!-- Cleanup -->
  <section class="card">
    <h2>üßπ Cleanup (After Workshop)</h2>
    <p style="font-size:13px;margin-bottom:10px;">Delete all resources to avoid charges:</p>
    <pre>az group delete --name $env:AZURE_RESOURCE_GROUP --yes --no-wait</pre>
    <div class="note note-warn">
      <strong>Warning:</strong> This deletes ALL resources in the resource group permanently.
    </div>
  </section>

  <!-- What's Next -->
  <section class="card" style="text-align:center;border-top:3px solid var(--ok);">
    <h2 style="margin-top:0;">üéâ Workshop Complete!</h2>
    <div class="pillrow" style="justify-content:center;margin:14px 0;">
      <span class="pill">‚úÖ Azure AI Foundry</span>
      <span class="pill">‚úÖ Azure OpenAI</span>
      <span class="pill">‚úÖ AI Search</span>
      <span class="pill">‚úÖ Vector Embeddings</span>
      <span class="pill">‚úÖ RAG Chatbot</span>
      <span class="pill">‚úÖ RBAC Auth</span>
      <span class="pill">‚úÖ Evaluation</span>
      <span class="pill">‚úÖ Content Safety</span>
      <span class="pill">‚úÖ Model Swap</span>
      <span class="pill">‚úÖ CI/CD Gates</span>
      <span class="pill">‚úÖ MLflow GenAI</span>
    </div>

    <h3 style="font-size:14px;margin-bottom:8px;">üìä Your Results Summary</h3>
    <p style="font-size:12px;text-align:left;max-width:600px;margin:0 auto 10px;">Run <code>python 02-evaluation/run_evaluation.py</code> to test RAG quality:</p>
    <table style="font-size:11px;margin:0 auto 15px;border-collapse:collapse;">
      <tr style="background:var(--surface);">
        <th style="padding:6px 12px;border:1px solid var(--border);">Metric</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Score</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Standard</th>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Groundedness</td>
        <td style="padding:6px 12px;border:1px solid var(--border);color:var(--warn);">2.6/5.0</td>
        <td style="padding:6px 12px;border:1px solid var(--border);">‚â•4.0 for production</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Fluency</td>
        <td style="padding:6px 12px;border:1px solid var(--border);color:var(--ok);">3.0/5.0</td>
        <td style="padding:6px 12px;border:1px solid var(--border);">‚â•4.0 for production</td>
      </tr>
    </table>
    <p style="font-size:11px;color:var(--muted);max-width:600px;margin:0 auto 15px;"><strong>Note:</strong> Low groundedness is expected in demo (context only has titles). Production RAG with full document retrieval scores higher.</p>

    <h3 style="font-size:14px;margin-bottom:8px;">ÔøΩÔ∏è Content Safety Testing</h3>
    <p style="font-size:12px;text-align:left;max-width:600px;margin:0 auto 10px;">Run <code>python 03-content-safety/test_content_safety.py</code> to test protection:</p>
    <table style="font-size:11px;margin:0 auto 15px;border-collapse:collapse;">
      <tr style="background:var(--surface);">
        <th style="padding:6px 12px;border:1px solid var(--border);">Category</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Result</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Protection</th>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Baseline (safe)</td>
        <td style="padding:6px 12px;border:1px solid var(--border);color:var(--ok);">‚úì Pass</td>
        <td style="padding:6px 12px;border:1px solid var(--border);">Allowed</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Jailbreak attempts</td>
        <td style="padding:6px 12px;border:1px solid var(--border);color:var(--ok);">‚úì Pass</td>
        <td style="padding:6px 12px;border:1px solid var(--border);">Model refused</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">PII requests</td>
        <td style="padding:6px 12px;border:1px solid var(--border);color:var(--ok);">‚úì Pass</td>
        <td style="padding:6px 12px;border:1px solid var(--border);">Model refused</td>
      </tr>
    </table>
    <p style="font-size:11px;color:var(--muted);max-width:600px;margin:0 auto 15px;"><strong>Key:</strong> Default filters block hate/sexual/violence/self-harm. Jailbreaks are handled by system prompt.</p>

    <h3 style="font-size:14px;margin-bottom:8px;">ÔøΩ LLMOps Summary</h3>
    <table style="font-size:11px;margin:0 auto 15px;border-collapse:collapse;max-width:600px;">
      <tr style="background:var(--surface);">
        <th style="padding:6px 12px;border:1px solid var(--border);">Module</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Script</th>
        <th style="padding:6px 12px;border:1px solid var(--border);">Purpose</th>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Enhanced Eval</td>
        <td style="padding:6px 12px;border:1px solid var(--border);"><code>02-evaluation/run_evaluation_enhanced.py</code></td>
        <td style="padding:6px 12px;border:1px solid var(--border);">4-metric eval with pass/fail gates</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">Model Swap</td>
        <td style="padding:6px 12px;border:1px solid var(--border);"><code>05-model-swap/model_swap_eval.py</code></td>
        <td style="padding:6px 12px;border:1px solid var(--border);">Side-by-side model comparison</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">CI/CD Pipeline</td>
        <td style="padding:6px 12px;border:1px solid var(--border);"><code>06-cicd/azure-pipelines.yml</code></td>
        <td style="padding:6px 12px;border:1px solid var(--border);">4-stage pipeline with promotion gates</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">MLflow Tracing</td>
        <td style="padding:6px 12px;border:1px solid var(--border);"><code>07-mlflow/mlflow_tracing_demo.py</code></td>
        <td style="padding:6px 12px;border:1px solid var(--border);">Auto-tracing + prompt versioning</td>
      </tr>
      <tr>
        <td style="padding:6px 12px;border:1px solid var(--border);">MLflow Eval</td>
        <td style="padding:6px 12px;border:1px solid var(--border);"><code>07-mlflow/mlflow_eval_demo.py</code></td>
        <td style="padding:6px 12px;border:1px solid var(--border);">mlflow.evaluate() + custom evaluators</td>
      </tr>
    </table>

    <h3 style="font-size:14px;margin-bottom:8px;">üìö Next Steps to Explore</h3>
    <ul style="text-align:left;font-size:12px;max-width:600px;margin:0 auto;">
      <li><strong>Add Your Data:</strong> Drop .txt, .md, or .pdf files into the <code>data/</code> folder and re-run indexer</li>
      <li><strong>Deploy to Production (Optional):</strong> Run <code>.\04-frontend\deploy-to-azure.ps1</code> to host on Azure App Service</li>
      <li><strong>Connect Azure DevOps:</strong> Import the repo and create a pipeline from <code>06-cicd/azure-pipelines.yml</code></li>
      <li><strong>Remote MLflow Tracking:</strong> Connect MLflow to Azure ML workspace for team-wide experiment tracking</li>
      <li><strong>Prompt Shields:</strong> Enable Prompt Shields in Azure OpenAI for production-grade jailbreak protection</li>
    </ul>

    <h3 style="font-size:14px;margin:16px 0 8px;">üìñ Learn More</h3>
    <ul style="text-align:left;font-size:12px;max-width:600px;margin:0 auto;list-style:none;padding:0;">
      <li>üîó <a href="https://learn.microsoft.com/azure/ai-studio/" target="_blank">Azure AI Foundry Documentation</a></li>
      <li>üîó <a href="https://learn.microsoft.com/azure/ai-services/openai/" target="_blank">Azure OpenAI Service</a></li>
      <li>üîó <a href="https://learn.microsoft.com/azure/search/vector-search-overview" target="_blank">Azure AI Search Vector Search</a></li>
    </ul>
  </section>

  <footer>LLMOps Workshop Playbook v3.0 | February 2026 | Azure AI Foundry + MLflow</footer>
</div>
</body>
</html>
